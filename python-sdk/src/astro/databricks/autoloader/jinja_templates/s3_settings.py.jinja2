{% macro s3_settings() -%}
# These commands can be autogenerated specifically for s3 users
aws_access_key_id = dbutils.secrets.get("my-scope", key = "aws_access_key_id")
aws_secret_access_key = dbutils.secrets.get("my-scope", key = "aws_secret_access_key")
aws_session_token = dbutils.secrets.get("my-scope", key = "aws_session_token")

sc._jsc.hadoopConfiguration().set("fs.s3a.aws.credentials.provider", "org.apache.hadoop.fs.s3a.TemporaryAWSCredentialsProvider")
sc._jsc.hadoopConfiguration().set("fs.s3a.access.key", aws_access_key_id)
sc._jsc.hadoopConfiguration().set("fs.s3a.secret.key", aws_secret_access_key)
sc._jsc.hadoopConfiguration().set("fs.s3a.session.token", aws_session_token)
{%- endmacro -%}
